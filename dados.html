<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dados Completos - Dashboard Budista</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <span class="dharma-wheel">‚ò∏</span> Dashboard Budista
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">üè† Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="duthanga.html">üèÆ Pr√°ticas Duthanga</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="antropometria.html">üìä Antropometria</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="dados.html">üìã Dados Completos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="sobre.html">‚ÑπÔ∏è Sobre</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Cabe√ßalho -->
        <div class="row">
            <div class="col-md-12">
                <div class="page-header">
                    <h1>üìã Hist√≥rico Completo de Dados</h1>
                    <p class="lead">Todos os registros de pr√°ticas Duthanga e medi√ß√µes antropom√©tricas</p>
                </div>
            </div>
        </div>

        <!-- Estat√≠sticas R√°pidas -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-icon">üèÆ</div>
                    <div class="stats-content">
                        <h4 id="total-geral">0</h4>
                        <p>Duthanga Geral</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-icon">üçΩÔ∏è</div>
                    <div class="stats-content">
                        <h4 id="total-refeicao">0</h4>
                        <p>Uma Refei√ß√£o</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-icon">‚öñÔ∏è</div>
                    <div class="stats-content">
                        <h4 id="total-peso">0</h4>
                        <p>Ganho de Peso</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-icon">üìä</div>
                    <div class="stats-content">
                        <h4 id="total-registros">0</h4>
                        <p>Total de Registros</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filtros e Controles -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="filters-card">
                    <h5>üîç Filtros e Configura√ß√µes</h5>
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Pr√°tica</label>
                            <input type="text" class="form-control" value="Duthanga Geral (Todos os dados)" readonly disabled>
                        </div>
                        <div class="col-md-3">
                            <label for="date-from" class="form-label">Data Inicial</label>
                            <input type="date" class="form-control" id="date-from">
                        </div>
                        <div class="col-md-3">
                            <label for="date-to" class="form-label">Data Final</label>
                            <input type="date" class="form-control" id="date-to">
                        </div>
                        <div class="col-md-3 d-flex align-items-end">
                            <button class="btn btn-primary me-2" onclick="applyFilters()">Aplicar Filtros</button>
                            <button class="btn btn-outline-secondary" onclick="clearFilters()">Limpar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- A√ß√µes R√°pidas -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="actions-card">
                    <h6>‚ö° A√ß√µes R√°pidas</h6>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary" onclick="exportData('csv')">
                            üìä Exportar CSV
                        </button>
                        <button type="button" class="btn btn-outline-success" onclick="exportData('excel')">
                            üìà Exportar Excel
                        </button>
                        <button type="button" class="btn btn-outline-info" onclick="printTable()">
                            üñ®Ô∏è Imprimir
                        </button>
                        <button type="button" class="btn btn-outline-warning" onclick="refreshData()">
                            üîÑ Atualizar Dados
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabela Principal -->
        <div class="row">
            <div class="col-md-12">
                <div class="table-card">
                    <h5>üìã Tabela Completa de Dados</h5>
                    <div class="table-loading text-center py-4" id="table-loading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                        <p class="mt-2">Carregando dados da planilha...</p>
                    </div>
                    <div id="complete-table-container" style="display: none;">
                        <!-- Tabela ser√° carregada aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumo Estat√≠stico -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="summary-card">
                    <h5>üìà Resumo Estat√≠stico - Peso</h5>
                    <table class="table table-sm">
                        <tbody>
                            <tr>
                                <td><strong>Peso M√≠nimo:</strong></td>
                                <td id="peso-min">--</td>
                            </tr>
                            <tr>
                                <td><strong>Peso M√°ximo:</strong></td>
                                <td id="peso-max">--</td>
                            </tr>
                            <tr>
                                <td><strong>Peso M√©dio:</strong></td>
                                <td id="peso-medio">--</td>
                            </tr>
                            <tr>
                                <td><strong>Varia√ß√£o Total:</strong></td>
                                <td id="peso-variacao">--</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-md-6">
                <div class="summary-card">
                    <h5>üìè Resumo Estat√≠stico - IMC</h5>
                    <table class="table table-sm">
                        <tbody>
                            <tr>
                                <td><strong>IMC M√≠nimo:</strong></td>
                                <td id="imc-min">--</td>
                            </tr>
                            <tr>
                                <td><strong>IMC M√°ximo:</strong></td>
                                <td id="imc-max">--</td>
                            </tr>
                            <tr>
                                <td><strong>IMC M√©dio:</strong></td>
                                <td id="imc-medio">--</td>
                            </tr>
                            <tr>
                                <td><strong>Categoria Atual:</strong></td>
                                <td id="imc-categoria">--</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Timeline dos Registros -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="timeline-card">
                    <h5>‚è∞ Timeline dos Registros</h5>
                    <div class="timeline-info">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="timeline-item">
                                    <strong>Primeiro Registro:</strong>
                                    <span id="first-record">--/--/----</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="timeline-item">
                                    <strong>√öltimo Registro:</strong>
                                    <span id="last-record">--/--/----</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="timeline-item">
                                    <strong>Per√≠odo Total:</strong>
                                    <span id="total-period">-- dias</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navega√ß√£o -->
        <div class="row mt-4">
            <div class="col-md-6">
                <a href="antropometria.html" class="btn btn-outline-primary">
                    ‚Üê Antropometria
                </a>
            </div>
            <div class="col-md-6 text-end">
                <a href="sobre.html" class="btn btn-primary">
                    Sobre o Projeto ‚Üí
                </a>
            </div>
        </div>
    </div>

    <footer class="footer mt-5">
        <div class="container">
            <div class="zen-quote text-center">
                "Nos dados encontramos sabedoria, na sabedoria encontramos o caminho"
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.csv.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.excel.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
    <script src="dashboard.js"></script>
    <script>
        // Fun√ß√µes espec√≠ficas da p√°gina de dados
        function applyFilters() {
            const dateFrom = document.getElementById('date-from').value;
            const dateTo = document.getElementById('date-to').value;
            
            if (window.dataTable) {
                // Limpar filtros anteriores
                $.fn.dataTable.ext.search.pop();
                
                // Filtro personalizado por data (formato brasileiro dd/mm/yyyy)
                if (dateFrom || dateTo) {
                    $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                        const dateStr = data[0]; // Coluna de data
                        
                        // Converter data brasileira dd/mm/yyyy para objeto Date
                        const parts = dateStr.split('/');
                        if (parts.length !== 3) return true;
                        
                        const rowDate = new Date(parts[2], parts[1] - 1, parts[0]); // yyyy, mm-1, dd
                        
                        // Verificar filtros
                        if (dateFrom) {
                            const fromDate = new Date(dateFrom);
                            if (rowDate < fromDate) return false;
                        }
                        
                        if (dateTo) {
                            const toDate = new Date(dateTo);
                            if (rowDate > toDate) return false;
                        }
                        
                        return true;
                    });
                }
                
                window.dataTable.draw();
            }
        }
        
        function clearFilters() {
            document.getElementById('date-from').value = '';
            document.getElementById('date-to').value = '';
            
            if (window.dataTable) {
                // Limpar filtros customizados
                $.fn.dataTable.ext.search.pop();
                window.dataTable.draw();
            }
        }
        
        function exportData(format) {
            if (window.dataTable) {
                if (format === 'csv') {
                    window.dataTable.button(0).trigger(); // Primeiro bot√£o (CSV)
                } else if (format === 'excel') {
                    window.dataTable.button(1).trigger(); // Segundo bot√£o (Excel)
                }
            }
        }
        
        function printTable() {
            if (window.dataTable) {
                window.dataTable.button(2).trigger(); // Terceiro bot√£o (Print)
            }
        }
        
        function refreshData() {
            location.reload();
        }
        
        // Carregar dados espec√≠ficos da p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            loadCompleteTable();
            loadStatistics();
        });
        
        async function loadCompleteTable() {
            try {
                const response = await fetch('charts/complete_table.html');
                const tableHtml = await response.text();
                
                document.getElementById('table-loading').style.display = 'none';
                document.getElementById('complete-table-container').style.display = 'block';
                document.getElementById('complete-table-container').innerHTML = tableHtml;
                
                // Inicializar DataTable com recursos avan√ßados
                if (jQuery('#complete-data-table').length) {
                    window.dataTable = jQuery('#complete-data-table').DataTable({
                        dom: 'Bfrtip',
                        buttons: [
                            {
                                extend: 'csvHtml5',
                                text: 'üìÑ CSV',
                                className: 'btn btn-success btn-sm'
                            },
                            {
                                extend: 'excelHtml5', 
                                text: 'üìä Excel',
                                className: 'btn btn-primary btn-sm'
                            },
                            {
                                extend: 'print',
                                text: 'üñ®Ô∏è Imprimir',
                                className: 'btn btn-secondary btn-sm'
                            }
                        ],
                        pageLength: 25,
                        order: [[0, 'desc']],
                        columnDefs: [
                            {
                                targets: 0,
                                type: 'date-eu',
                                render: function(data, type, row) {
                                    if (type === 'sort' || type === 'type') {
                                        // Converter dd/mm/yyyy para yyyy-mm-dd para ordena√ß√£o
                                        var parts = data.split('/');
                                        if (parts.length === 3) {
                                            return parts[2] + '-' + parts[1] + '-' + parts[0];
                                        }
                                        return data;
                                    }
                                    return data;
                                }
                            }
                        ],
                        language: {
                            url: '//cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese-Brasil.json'
                        }
                    });
                }
            } catch (error) {
                document.getElementById('table-loading').innerHTML = 
                    '<p class="text-muted">Dados ser√£o carregados na pr√≥xima atualiza√ß√£o.</p>';
            }
        }
        
        function loadStatistics() {
            // Carregar estat√≠sticas dos dados
            // Implementar c√°lculos estat√≠sticos
        }
    </script>
</body>
</html>