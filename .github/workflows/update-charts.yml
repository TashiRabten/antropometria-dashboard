 name: Atualizar Gráficos Antropométricos                                                                                 

     on:
       schedule:
         # Executar a cada 6 horas
         - cron: '0 */6 * * *'
       workflow_dispatch: # Permite execução manual
       push:
         branches: [ main ]

     jobs:
       update-charts:
         runs-on: ubuntu-latest

         steps:
         - name: Checkout repository
           uses: actions/checkout@v3

         - name: Setup R
           uses: r-lib/actions/setup-r@v2
           with:
             r-version: '4.3.0'

         - name: Install system dependencies
           run: |
             sudo apt-get update
             sudo apt-get install -y libcurl4-openssl-dev libssl-dev libxml2-dev libfontconfig1-dev

         - name: Install R packages
           run: |
             R -e "install.packages(c('googlesheets4', 'ggplot2', 'dplyr', 'lubridate', 'jsonlite', 'RColorBrewer', 'tidyr'), 
     repos='https://cran.r-project.org')"

         - name: Create auth token file
           run: |
             echo '${{ secrets.GOOGLE_SHEETS_TOKEN }}' > auth_token.json

         - name: Generate charts
           run: |
             Rscript generate_charts.R

         - name: Update HTML with latest data
           run: |
             # Script para atualizar dados no HTML se necessário
             echo "Charts updated at $(date)" > charts/last_update.txt

         - name: Commit and push changes
           run: |
             git config --local user.email "action@github.com"
             git config --local user.name "GitHub Action"
             git add charts/
             git diff --staged --quiet || git commit -m "Atualização automática dos gráficos - $(date '+%Y-%m-%d %H:%M')"
             git push
           env:
             GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
